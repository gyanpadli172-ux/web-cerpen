<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Website Kumpulan Cerpen</title>

  <!-- QUILL EDITOR CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: #f2f4f7; color: #333; }
    header { background: linear-gradient(135deg,#5a3e85,#7c4dff); color:white; padding:30px 20px; text-align:center; }
    main { max-width:1200px; margin:auto; padding:20px; }
    .menu { display:flex; justify-content:center; gap:20px; margin-top:30px; flex-wrap:wrap; }
    .btn { background:linear-gradient(135deg,#6d48a8,#9c27b0); color:white; padding:12px 20px; border-radius:8px; cursor:pointer; border:none; }
    .section { display:none; margin-top:30px; }
    input[type="text"] { width:100%; padding:12px; margin-top:10px; border:1px solid #ddd; border-radius:8px; font-size:16px; }
    .editor-container { margin-top:10px; border:1px solid #ddd; border-radius:8px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:20px; margin-top:20px; }
    .card { background:white; padding:12px; border-radius:12px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.12); }
    .cover { width:100%; height:160px; border-radius:10px; background-size:cover; background-position:center; margin-bottom:10px; }
    #detailCover { width:380px; height:250px; margin:auto; margin-bottom:20px; border-radius:12px; background-size:cover; background-position:center; }
    #detailIsi { text-align:justify; margin-top:20px; font-size:17px; line-height:1.55; }
    footer { background:#5a3e85; color:white; text-align:center; padding:20px; margin-top:40px; }
  </style>
</head>

<body>

<header>
  <h1>Kumpulan Cerpen Peserta Didik Kelas XI.XI SMAN 2 Kuningan</h1>
  <p>Bagikan karyamu dan baca karya teman-temanmu!</p>
</header>

<main>

  <div class="menu">
    <div class="btn" onclick="showSection('upload')">Unggah Cerpen</div>
    <div class="btn" onclick="showSection('articles')">Lihat Cerpen</div>
  </div>

  <!-- UPLOAD SECTION -->
  <div id="upload" class="section">
    <h2>Unggah Cerpen Baru</h2>

    <label>Nama Penulis *</label>
    <input type="text" id="namaPenulis">

    <label>Judul Cerpen *</label>
    <input type="text" id="judul">

    <label>Link Gambar Cover (opsional)</label>
    <input type="text" id="coverUrl">

    <label>Isi Cerpen *</label>
    <div id="editorUpload" class="editor-container"></div>

    <button class="btn" onclick="saveCerpen()">Simpan</button>
  </div>

  <!-- ARTICLES LIST -->
  <div id="articles" class="section">
    <h2>Kumpulan Cerpen</h2>
    <div id="list" class="grid"></div>
  </div>

  <!-- DETAIL SECTION -->
  <div id="detail" class="section">
    <div id="detailCover"></div>
    <h2 id="detailJudul"></h2>
    <p id="detailPenulis"></p>
    <div id="detailIsi"></div>

    <button class="btn" onclick="startEdit()">Edit</button>
    <button class="btn" onclick="showSection('articles')">Kembali</button>
  </div>

  <!-- EDIT SECTION -->
  <div id="edit" class="section">
    <h2>Edit Cerpen</h2>

    <label>Nama Penulis *</label>
    <input type="text" id="editNamaPenulis">

    <label>Judul Cerpen *</label>
    <input type="text" id="editJudul">

    <label>Link Gambar Cover (opsional)</label>
    <input type="text" id="editCoverUrl">

    <label>Isi Cerpen *</label>
    <div id="editorEdit" class="editor-container"></div>

    <button class="btn" onclick="updateCerpen()">Perbarui</button>
    <button class="btn" onclick="showSection('detail')">Batal</button>
  </div>

</main>

<footer>&copy; 2025 Website Kumpulan Cerpen</footer>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<!-- QUILL JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>

  const firebaseConfig = {
    apiKey: "AIzaSyAtTEIsj-A_OY0wjkUFUcByG6XnStVqTSE",
    authDomain: "cerpenwoyla.firebaseapp.com",
    projectId: "cerpenwoyla",
    storageBucket: "cerpenwoyla.firebasestorage.app",
    messagingSenderId: "285662260886",
    appId: "1:285662260886:web:b2023d3a51c7e134f81cb7"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let cerpenList = [];
  let currentIndex = -1;

  const toolbarOptions = [
    ['bold', 'italic', 'underline'],
    [{ 'align': [] }],
    [{ 'list': 'bullet' }],
    [{ 'indent': '-1'}, { 'indent': '+1' }],
  ];

  const editorUpload = new Quill('#editorUpload', { theme: 'snow', modules:{ toolbar: toolbarOptions }});
  const editorEdit = new Quill('#editorEdit', { theme: 'snow', modules:{ toolbar: toolbarOptions }});

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    document.getElementById(id).style.display='block';
  }

  function saveCerpen() {
    const nama = namaPenulis.value.trim();
    const judul = judul.value.trim();
    const isiHTML = editorUpload.root.innerHTML.trim();
    const cover = coverUrl.value.trim();

    if (!nama || !judul || isiHTML === "<p><br></p>") {
      alert("Semua field wajib kecuali cover!");
      return;
    }

    db.collection("cerpensmanda").add({
      namaPenulis:nama,
      judul,
      isi: isiHTML,
      coverUrl: cover,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    editorUpload.root.innerHTML = "";
    showSection('articles');
  }

  db.collection("cerpensmanda")
    .orderBy("createdAt","asc")
    .onSnapshot(snapshot=>{
      cerpenList = snapshot.docs.map(doc=>({ id:doc.id, ...doc.data() }));
      updateList();
    });

  function updateList(){
    const container=document.getElementById('list');
    container.innerHTML="";

    cerpenList.forEach((c,i)=>{
      const div=document.createElement('div');
      div.className='card';
      div.onclick=()=>openDetail(i);

      div.innerHTML=`
        <div class="cover" style="${c.coverUrl?`background-image:url('${c.coverUrl}')`:`background-color:#bdbdbd`}"></div>
        <h3>${c.judul}</h3>
        <p><b>Oleh:</b> ${c.namaPenulis}</p>
      `;
      container.appendChild(div);
    });
  }

  function openDetail(i){
    currentIndex=i;
    const c=cerpenList[i];

    detailCover.style.backgroundImage = c.coverUrl ? `url('${c.coverUrl}')` : "none";
    detailCover.style.backgroundColor = c.coverUrl ? "transparent" : "#bdbdbd";

    detailJudul.innerText=c.judul;
    detailPenulis.innerText="Oleh: "+c.namaPenulis;
    detailIsi.innerHTML=c.isi;

    showSection('detail');
  }

  function startEdit(){
    const c=cerpenList[currentIndex];
    editNamaPenulis.value=c.namaPenulis;
    editJudul.value=c.judul;
    editCoverUrl.value=c.coverUrl;
    editorEdit.root.innerHTML=c.isi;
    showSection('edit');
  }

  function updateCerpen(){
    const id=cerpenList[currentIndex].id;

    db.collection("cerpensmanda").doc(id).update({
      namaPenulis: editNamaPenulis.value,
      judul: editJudul.value,
      isi: editorEdit.root.innerHTML,
      coverUrl: editCoverUrl.value.trim()
    });

    showSection('detail');
  }

  showSection('articles');
</script>

</body>
</html>